{
	default_sni {$DOMAIN:localhost}
}

{$DOMAIN:localhost} {
	tls /etc/caddy/certs/local.pem /etc/caddy/certs/local-key.pem

	# WebSocket signaling (for WebRTC fallback) â€” must be matched before reverse_proxy
	@websocket {
		path /ws
		header Connection *Upgrade*
		header Upgrade    websocket
	}
	reverse_proxy @websocket server:8081

	# C++ server HTTP API
	handle /api/* {
		reverse_proxy server:8080
	}

	# SvelteKit client (default route)
	reverse_proxy client:3000
}
